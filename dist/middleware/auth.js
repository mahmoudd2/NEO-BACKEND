"use strict";

const jwt = require('jsonwebtoken');
exports.verifyAdmin = (req, res, next) => {
  const auth = req.headers.authorization;
  if (!auth?.startsWith('Bearer ')) return res.status(401).json({
    message: 'No token'
  });
  try {
    const decoded = jwt.verify(auth.split(' ')[1], process.env.JWT_SECRET);
    if (decoded.role !== 'admin') return res.status(403).json({
      message: 'Admins only'
    });
    req.user = decoded;
    next();
  } catch {
    return res.status(403).json({
      message: 'Invalid or expired token'
    });
  }
};
exports.verifyCompanyManager = (req, res, next) => {
  const auth = req.headers.authorization;
  if (!auth?.startsWith('Bearer ')) return res.status(401).json({
    message: 'No token'
  });
  try {
    const decoded = jwt.verify(auth.split(' ')[1], process.env.JWT_SECRET);
    if (decoded.role !== 'companyManager') return res.status(403).json({
      message: 'Company Managers only'
    });
    req.user = decoded;
    next();
  } catch {
    return res.status(403).json({
      message: 'Invalid or expired token'
    });
  }
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJqd3QiLCJyZXF1aXJlIiwiZXhwb3J0cyIsInZlcmlmeUFkbWluIiwicmVxIiwicmVzIiwibmV4dCIsImF1dGgiLCJoZWFkZXJzIiwiYXV0aG9yaXphdGlvbiIsInN0YXJ0c1dpdGgiLCJzdGF0dXMiLCJqc29uIiwibWVzc2FnZSIsImRlY29kZWQiLCJ2ZXJpZnkiLCJzcGxpdCIsInByb2Nlc3MiLCJlbnYiLCJKV1RfU0VDUkVUIiwicm9sZSIsInVzZXIiLCJ2ZXJpZnlDb21wYW55TWFuYWdlciJdLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9taWRkbGV3YXJlL2F1dGguanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3Qgand0ID0gcmVxdWlyZSgnanNvbndlYnRva2VuJyk7XHJcblxyXG5leHBvcnRzLnZlcmlmeUFkbWluID0gKHJlcSwgcmVzLCBuZXh0KSA9PiB7XHJcbiAgY29uc3QgYXV0aCA9IHJlcS5oZWFkZXJzLmF1dGhvcml6YXRpb247XHJcbiAgaWYgKCFhdXRoPy5zdGFydHNXaXRoKCdCZWFyZXIgJykpIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7IG1lc3NhZ2U6ICdObyB0b2tlbicgfSk7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IGRlY29kZWQgPSBqd3QudmVyaWZ5KGF1dGguc3BsaXQoJyAnKVsxXSwgcHJvY2Vzcy5lbnYuSldUX1NFQ1JFVCk7XHJcbiAgICBpZiAoZGVjb2RlZC5yb2xlICE9PSAnYWRtaW4nKSByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oeyBtZXNzYWdlOiAnQWRtaW5zIG9ubHknIH0pO1xyXG4gICAgcmVxLnVzZXIgPSBkZWNvZGVkOyBuZXh0KCk7XHJcbiAgfSBjYXRjaCB7IHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7IG1lc3NhZ2U6ICdJbnZhbGlkIG9yIGV4cGlyZWQgdG9rZW4nIH0pOyB9XHJcbn07XHJcblxyXG5leHBvcnRzLnZlcmlmeUNvbXBhbnlNYW5hZ2VyID0gKHJlcSwgcmVzLCBuZXh0KSA9PiB7XHJcbiAgY29uc3QgYXV0aCA9IHJlcS5oZWFkZXJzLmF1dGhvcml6YXRpb247XHJcbiAgaWYgKCFhdXRoPy5zdGFydHNXaXRoKCdCZWFyZXIgJykpIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7IG1lc3NhZ2U6ICdObyB0b2tlbicgfSk7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IGRlY29kZWQgPSBqd3QudmVyaWZ5KGF1dGguc3BsaXQoJyAnKVsxXSwgcHJvY2Vzcy5lbnYuSldUX1NFQ1JFVCk7XHJcbiAgICBpZiAoZGVjb2RlZC5yb2xlICE9PSAnY29tcGFueU1hbmFnZXInKSByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oeyBtZXNzYWdlOiAnQ29tcGFueSBNYW5hZ2VycyBvbmx5JyB9KTtcclxuICAgIHJlcS51c2VyID0gZGVjb2RlZDsgbmV4dCgpO1xyXG4gIH0gY2F0Y2ggeyByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oeyBtZXNzYWdlOiAnSW52YWxpZCBvciBleHBpcmVkIHRva2VuJyB9KTsgfVxyXG59O1xyXG4iXSwibWFwcGluZ3MiOiI7O0FBQUEsTUFBTUEsR0FBRyxHQUFHQyxPQUFPLENBQUMsY0FBYyxDQUFDO0FBRW5DQyxPQUFPLENBQUNDLFdBQVcsR0FBRyxDQUFDQyxHQUFHLEVBQUVDLEdBQUcsRUFBRUMsSUFBSSxLQUFLO0VBQ3hDLE1BQU1DLElBQUksR0FBR0gsR0FBRyxDQUFDSSxPQUFPLENBQUNDLGFBQWE7RUFDdEMsSUFBSSxDQUFDRixJQUFJLEVBQUVHLFVBQVUsQ0FBQyxTQUFTLENBQUMsRUFBRSxPQUFPTCxHQUFHLENBQUNNLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQ0MsSUFBSSxDQUFDO0lBQUVDLE9BQU8sRUFBRTtFQUFXLENBQUMsQ0FBQztFQUN0RixJQUFJO0lBQ0YsTUFBTUMsT0FBTyxHQUFHZCxHQUFHLENBQUNlLE1BQU0sQ0FBQ1IsSUFBSSxDQUFDUyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUVDLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDQyxVQUFVLENBQUM7SUFDdEUsSUFBSUwsT0FBTyxDQUFDTSxJQUFJLEtBQUssT0FBTyxFQUFFLE9BQU9mLEdBQUcsQ0FBQ00sTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDQyxJQUFJLENBQUM7TUFBRUMsT0FBTyxFQUFFO0lBQWMsQ0FBQyxDQUFDO0lBQ3JGVCxHQUFHLENBQUNpQixJQUFJLEdBQUdQLE9BQU87SUFBRVIsSUFBSSxDQUFDLENBQUM7RUFDNUIsQ0FBQyxDQUFDLE1BQU07SUFBRSxPQUFPRCxHQUFHLENBQUNNLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQ0MsSUFBSSxDQUFDO01BQUVDLE9BQU8sRUFBRTtJQUEyQixDQUFDLENBQUM7RUFBRTtBQUNsRixDQUFDO0FBRURYLE9BQU8sQ0FBQ29CLG9CQUFvQixHQUFHLENBQUNsQixHQUFHLEVBQUVDLEdBQUcsRUFBRUMsSUFBSSxLQUFLO0VBQ2pELE1BQU1DLElBQUksR0FBR0gsR0FBRyxDQUFDSSxPQUFPLENBQUNDLGFBQWE7RUFDdEMsSUFBSSxDQUFDRixJQUFJLEVBQUVHLFVBQVUsQ0FBQyxTQUFTLENBQUMsRUFBRSxPQUFPTCxHQUFHLENBQUNNLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQ0MsSUFBSSxDQUFDO0lBQUVDLE9BQU8sRUFBRTtFQUFXLENBQUMsQ0FBQztFQUN0RixJQUFJO0lBQ0YsTUFBTUMsT0FBTyxHQUFHZCxHQUFHLENBQUNlLE1BQU0sQ0FBQ1IsSUFBSSxDQUFDUyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUVDLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDQyxVQUFVLENBQUM7SUFDdEUsSUFBSUwsT0FBTyxDQUFDTSxJQUFJLEtBQUssZ0JBQWdCLEVBQUUsT0FBT2YsR0FBRyxDQUFDTSxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUNDLElBQUksQ0FBQztNQUFFQyxPQUFPLEVBQUU7SUFBd0IsQ0FBQyxDQUFDO0lBQ3hHVCxHQUFHLENBQUNpQixJQUFJLEdBQUdQLE9BQU87SUFBRVIsSUFBSSxDQUFDLENBQUM7RUFDNUIsQ0FBQyxDQUFDLE1BQU07SUFBRSxPQUFPRCxHQUFHLENBQUNNLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQ0MsSUFBSSxDQUFDO01BQUVDLE9BQU8sRUFBRTtJQUEyQixDQUFDLENBQUM7RUFBRTtBQUNsRixDQUFDIiwiaWdub3JlTGlzdCI6W119