"use strict";

const bcrypt = require('bcryptjs');
const repo = require('./models');
const mailer = require('../../utils/mailer');

// tiny validator like in your snippet
const validateFields = (body, required) => {
  for (const f of required) if (body[f] == null || body[f] === '') return `Missing field: ${f}`;
  return null;
};
exports.createUser = async (req, res) => {
  const required = ['roleId', 'companyId', 'userName', 'firstName', 'lastName', 'email'];
  const error = validateFields(req.body, required);
  if (error) return res.status(400).json({
    message: error
  });
  try {
    // generate + hash password
    const generatedPassword = Math.random().toString(36).slice(-8);
    const hashedPassword = await bcrypt.hash(generatedPassword, 10);
    const userPayload = {
      ...req.body,
      password: hashedPassword
    };
    const user = await repo.create(userPayload);
    return res.status(201).json({
      message: 'User created successfully',
      user,
      // no password included
      generatedPassword // sent once so the admin can share it
    });
  } catch (e) {
    console.error(e);
    return res.status(500).json({
      message: 'Failed to create user'
    });
  }
};
exports.getAllUsers = async (_req, res) => {
  try {
    const users = await repo.list();
    return res.status(200).json(users);
  } catch (e) {
    console.error(e);
    return res.status(500).json({
      message: 'Failed to fetch users'
    });
  }
};
exports.getUsersByCompany = async (req, res) => {
  const {
    companyId
  } = req.params;
  if (!companyId) return res.status(400).json({
    message: 'Company ID is required'
  });
  try {
    const users = await repo.listByCompany(companyId);
    return res.status(200).json(users);
  } catch (e) {
    console.error(e);
    return res.status(500).json({
      message: 'Failed to fetch users for this company'
    });
  }
};
exports.getUserById = async (req, res) => {
  const {
    id
  } = req.params;
  if (!id) return res.status(400).json({
    message: 'User ID is required'
  });
  try {
    const user = await repo.getById(id);
    if (!user) return res.status(404).json({
      message: 'User not found'
    });
    return res.status(200).json(user);
  } catch (e) {
    console.error(e);
    return res.status(500).json({
      message: 'Failed to fetch user'
    });
  }
};
exports.deleteUser = async (req, res) => {
  const {
    id
  } = req.params;
  if (!id) return res.status(400).json({
    message: 'User ID is required'
  });
  try {
    await repo.remove(id);
    return res.status(204).send();
  } catch (e) {
    console.error(e);
    return res.status(500).json({
      message: 'Failed to delete user'
    });
  }
};

/** UPDATE USER */
exports.updateUser = async (req, res) => {
  const {
    id
  } = req.params;
  if (!id) return res.status(400).json({
    message: 'User ID is required'
  });
  try {
    const updated = await repo.update(id, req.body);
    if (!updated) return res.status(404).json({
      message: 'User not found'
    });
    return res.json({
      message: 'User updated',
      user: updated
    });
  } catch (e) {
    console.error(e);
    return res.status(500).json({
      message: 'Failed to update user'
    });
  }
};

/** RESET PASSWORD (admin-triggered) */
exports.resetPassword = async (req, res) => {
  const {
    id
  } = req.params;
  if (!id) return res.status(400).json({
    message: 'User ID is required'
  });
  try {
    // get user with Email (ensure your repo returns Email)
    const user = await (repo.getEmailById ? repo.getEmailById(id) : repo.getById(id));
    if (!user) return res.status(404).json({
      message: 'User not found'
    });
    if (!user.Email) return res.status(400).json({
      message: 'User has no email on file'
    });

    // generate + hash temp password
    const generatedPassword = Math.random().toString(36).slice(-10);
    const hashed = await bcrypt.hash(generatedPassword, 10);
    await repo.setPassword(id, hashed);

    // send email
    const subject = 'Your password has been reset';
    const text = `Hi${user.FirstName ? ' ' + user.FirstName : ''},
    Your temporary password is: ${generatedPassword}
    Please log in and change it immediately.`;
    const html = `<p>Hi${user.FirstName ? ' ' + user.FirstName : ''},</p>
    <p>Your temporary password is: <b>${generatedPassword}</b></p>
    <p>Please log in and change it immediately.</p>
    <p>â€” ${process.env.APP_NAME || 'Our App'}</p>`;
    await mailer.sendMail({
      to: user.Email,
      subject,
      text,
      html
    });
    return res.json({
      message: 'Password reset. Email sent to user.'
    });
  } catch (e) {
    console.error('resetPassword error:', e);
    return res.status(500).json({
      message: 'Password updated, but failed to send email.'
    });
  }
};
exports.changeMyPassword = async (req, res) => {
  const userId = req.user?.id; // set by your auth middleware
  const {
    oldPassword,
    newPassword
  } = req.body || {};
  if (!userId || !oldPassword || !newPassword) return res.status(400).json({
    message: 'oldPassword and newPassword are required'
  });
  try {
    const user = await repo.getById(userId);
    const ok = await bcrypt.compare(oldPassword, user.Password);
    if (!ok) return res.status(401).json({
      message: 'Old password is incorrect'
    });
    const hashed = await bcrypt.hash(newPassword, 10);
    await repo.setPassword(userId, hashed);
    res.json({
      message: 'Password changed successfully'
    });
  } catch (e) {
    console.error(e);
    res.status(500).json({
      message: 'Failed to change password'
    });
  }
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJiY3J5cHQiLCJyZXF1aXJlIiwicmVwbyIsIm1haWxlciIsInZhbGlkYXRlRmllbGRzIiwiYm9keSIsInJlcXVpcmVkIiwiZiIsImV4cG9ydHMiLCJjcmVhdGVVc2VyIiwicmVxIiwicmVzIiwiZXJyb3IiLCJzdGF0dXMiLCJqc29uIiwibWVzc2FnZSIsImdlbmVyYXRlZFBhc3N3b3JkIiwiTWF0aCIsInJhbmRvbSIsInRvU3RyaW5nIiwic2xpY2UiLCJoYXNoZWRQYXNzd29yZCIsImhhc2giLCJ1c2VyUGF5bG9hZCIsInBhc3N3b3JkIiwidXNlciIsImNyZWF0ZSIsImUiLCJjb25zb2xlIiwiZ2V0QWxsVXNlcnMiLCJfcmVxIiwidXNlcnMiLCJsaXN0IiwiZ2V0VXNlcnNCeUNvbXBhbnkiLCJjb21wYW55SWQiLCJwYXJhbXMiLCJsaXN0QnlDb21wYW55IiwiZ2V0VXNlckJ5SWQiLCJpZCIsImdldEJ5SWQiLCJkZWxldGVVc2VyIiwicmVtb3ZlIiwic2VuZCIsInVwZGF0ZVVzZXIiLCJ1cGRhdGVkIiwidXBkYXRlIiwicmVzZXRQYXNzd29yZCIsImdldEVtYWlsQnlJZCIsIkVtYWlsIiwiaGFzaGVkIiwic2V0UGFzc3dvcmQiLCJzdWJqZWN0IiwidGV4dCIsIkZpcnN0TmFtZSIsImh0bWwiLCJwcm9jZXNzIiwiZW52IiwiQVBQX05BTUUiLCJzZW5kTWFpbCIsInRvIiwiY2hhbmdlTXlQYXNzd29yZCIsInVzZXJJZCIsIm9sZFBhc3N3b3JkIiwibmV3UGFzc3dvcmQiLCJvayIsImNvbXBhcmUiLCJQYXNzd29yZCJdLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9tb2R1bGVzL3VzZXJzL2NvbnRyb2xsZXIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgYmNyeXB0ID0gcmVxdWlyZSgnYmNyeXB0anMnKTtcclxuY29uc3QgcmVwbyA9IHJlcXVpcmUoJy4vbW9kZWxzJyk7XHJcbmNvbnN0IG1haWxlciA9IHJlcXVpcmUoJy4uLy4uL3V0aWxzL21haWxlcicpO1xyXG5cclxuLy8gdGlueSB2YWxpZGF0b3IgbGlrZSBpbiB5b3VyIHNuaXBwZXRcclxuY29uc3QgdmFsaWRhdGVGaWVsZHMgPSAoYm9keSwgcmVxdWlyZWQpID0+IHtcclxuICBmb3IgKGNvbnN0IGYgb2YgcmVxdWlyZWQpIGlmIChib2R5W2ZdID09IG51bGwgfHwgYm9keVtmXSA9PT0gJycpIHJldHVybiBgTWlzc2luZyBmaWVsZDogJHtmfWA7XHJcbiAgcmV0dXJuIG51bGw7XHJcbn07XHJcblxyXG5leHBvcnRzLmNyZWF0ZVVzZXIgPSBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICBjb25zdCByZXF1aXJlZCA9IFsncm9sZUlkJywgJ2NvbXBhbnlJZCcsICd1c2VyTmFtZScsICdmaXJzdE5hbWUnLCAnbGFzdE5hbWUnLCAnZW1haWwnXTtcclxuICBjb25zdCBlcnJvciA9IHZhbGlkYXRlRmllbGRzKHJlcS5ib2R5LCByZXF1aXJlZCk7XHJcbiAgaWYgKGVycm9yKSByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBtZXNzYWdlOiBlcnJvciB9KTtcclxuXHJcbiAgdHJ5IHtcclxuICAgIC8vIGdlbmVyYXRlICsgaGFzaCBwYXNzd29yZFxyXG4gICAgY29uc3QgZ2VuZXJhdGVkUGFzc3dvcmQgPSBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zbGljZSgtOCk7XHJcbiAgICBjb25zdCBoYXNoZWRQYXNzd29yZCA9IGF3YWl0IGJjcnlwdC5oYXNoKGdlbmVyYXRlZFBhc3N3b3JkLCAxMCk7XHJcblxyXG4gICAgY29uc3QgdXNlclBheWxvYWQgPSB7IC4uLnJlcS5ib2R5LCBwYXNzd29yZDogaGFzaGVkUGFzc3dvcmQgfTtcclxuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCByZXBvLmNyZWF0ZSh1c2VyUGF5bG9hZCk7XHJcblxyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAxKS5qc29uKHtcclxuICAgICAgbWVzc2FnZTogJ1VzZXIgY3JlYXRlZCBzdWNjZXNzZnVsbHknLFxyXG4gICAgICB1c2VyLCAgICAgICAgICAgICAgICAvLyBubyBwYXNzd29yZCBpbmNsdWRlZFxyXG4gICAgICBnZW5lcmF0ZWRQYXNzd29yZCAgICAvLyBzZW50IG9uY2Ugc28gdGhlIGFkbWluIGNhbiBzaGFyZSBpdFxyXG4gICAgfSk7XHJcbiAgfSBjYXRjaCAoZSkge1xyXG4gICAgY29uc29sZS5lcnJvcihlKTtcclxuICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbih7IG1lc3NhZ2U6ICdGYWlsZWQgdG8gY3JlYXRlIHVzZXInIH0pO1xyXG4gIH1cclxufTtcclxuXHJcbmV4cG9ydHMuZ2V0QWxsVXNlcnMgPSBhc3luYyAoX3JlcSwgcmVzKSA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHVzZXJzID0gYXdhaXQgcmVwby5saXN0KCk7XHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24odXNlcnMpO1xyXG4gIH0gY2F0Y2ggKGUpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoZSk7XHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmpzb24oeyBtZXNzYWdlOiAnRmFpbGVkIHRvIGZldGNoIHVzZXJzJyB9KTtcclxuICB9XHJcbn07XHJcblxyXG5leHBvcnRzLmdldFVzZXJzQnlDb21wYW55ID0gYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgY29uc3QgeyBjb21wYW55SWQgfSA9IHJlcS5wYXJhbXM7XHJcbiAgaWYgKCFjb21wYW55SWQpIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IG1lc3NhZ2U6ICdDb21wYW55IElEIGlzIHJlcXVpcmVkJyB9KTtcclxuXHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHVzZXJzID0gYXdhaXQgcmVwby5saXN0QnlDb21wYW55KGNvbXBhbnlJZCk7XHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24odXNlcnMpO1xyXG4gIH0gY2F0Y2ggKGUpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoZSk7XHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmpzb24oeyBtZXNzYWdlOiAnRmFpbGVkIHRvIGZldGNoIHVzZXJzIGZvciB0aGlzIGNvbXBhbnknIH0pO1xyXG4gIH1cclxufTtcclxuXHJcbmV4cG9ydHMuZ2V0VXNlckJ5SWQgPSBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICBjb25zdCB7IGlkIH0gPSByZXEucGFyYW1zO1xyXG4gIGlmICghaWQpIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IG1lc3NhZ2U6ICdVc2VyIElEIGlzIHJlcXVpcmVkJyB9KTtcclxuXHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCByZXBvLmdldEJ5SWQoaWQpO1xyXG4gICAgaWYgKCF1c2VyKSByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oeyBtZXNzYWdlOiAnVXNlciBub3QgZm91bmQnIH0pO1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKHVzZXIpO1xyXG4gIH0gY2F0Y2ggKGUpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoZSk7XHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmpzb24oeyBtZXNzYWdlOiAnRmFpbGVkIHRvIGZldGNoIHVzZXInIH0pO1xyXG4gIH1cclxufTtcclxuXHJcbmV4cG9ydHMuZGVsZXRlVXNlciA9IGFzeW5jIChyZXEsIHJlcykgPT4ge1xyXG4gIGNvbnN0IHsgaWQgfSA9IHJlcS5wYXJhbXM7XHJcbiAgaWYgKCFpZCkgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgbWVzc2FnZTogJ1VzZXIgSUQgaXMgcmVxdWlyZWQnIH0pO1xyXG5cclxuICB0cnkge1xyXG4gICAgYXdhaXQgcmVwby5yZW1vdmUoaWQpO1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoMjA0KS5zZW5kKCk7XHJcbiAgfSBjYXRjaCAoZSkge1xyXG4gICAgY29uc29sZS5lcnJvcihlKTtcclxuICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbih7IG1lc3NhZ2U6ICdGYWlsZWQgdG8gZGVsZXRlIHVzZXInIH0pO1xyXG4gIH1cclxufTtcclxuXHJcblxyXG4vKiogVVBEQVRFIFVTRVIgKi9cclxuZXhwb3J0cy51cGRhdGVVc2VyID0gYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgY29uc3QgeyBpZCB9ID0gcmVxLnBhcmFtcztcclxuICBpZiAoIWlkKSByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBtZXNzYWdlOiAnVXNlciBJRCBpcyByZXF1aXJlZCcgfSk7XHJcblxyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB1cGRhdGVkID0gYXdhaXQgcmVwby51cGRhdGUoaWQsIHJlcS5ib2R5KTtcclxuICAgIGlmICghdXBkYXRlZCkgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHsgbWVzc2FnZTogJ1VzZXIgbm90IGZvdW5kJyB9KTtcclxuICAgIHJldHVybiByZXMuanNvbih7IG1lc3NhZ2U6ICdVc2VyIHVwZGF0ZWQnLCB1c2VyOiB1cGRhdGVkIH0pO1xyXG4gIH0gY2F0Y2ggKGUpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoZSk7XHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmpzb24oeyBtZXNzYWdlOiAnRmFpbGVkIHRvIHVwZGF0ZSB1c2VyJyB9KTtcclxuICB9XHJcbn07XHJcblxyXG4vKiogUkVTRVQgUEFTU1dPUkQgKGFkbWluLXRyaWdnZXJlZCkgKi9cclxuZXhwb3J0cy5yZXNldFBhc3N3b3JkID0gYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgY29uc3QgeyBpZCB9ID0gcmVxLnBhcmFtcztcclxuICBpZiAoIWlkKSByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBtZXNzYWdlOiAnVXNlciBJRCBpcyByZXF1aXJlZCcgfSk7XHJcblxyXG4gIHRyeSB7XHJcbiAgICAvLyBnZXQgdXNlciB3aXRoIEVtYWlsIChlbnN1cmUgeW91ciByZXBvIHJldHVybnMgRW1haWwpXHJcbiAgICBjb25zdCB1c2VyID0gYXdhaXQgKHJlcG8uZ2V0RW1haWxCeUlkID8gcmVwby5nZXRFbWFpbEJ5SWQoaWQpIDogcmVwby5nZXRCeUlkKGlkKSk7XHJcbiAgICBpZiAoIXVzZXIpIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7IG1lc3NhZ2U6ICdVc2VyIG5vdCBmb3VuZCcgfSk7XHJcbiAgICBpZiAoIXVzZXIuRW1haWwpIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IG1lc3NhZ2U6ICdVc2VyIGhhcyBubyBlbWFpbCBvbiBmaWxlJyB9KTtcclxuXHJcbiAgICAvLyBnZW5lcmF0ZSArIGhhc2ggdGVtcCBwYXNzd29yZFxyXG4gICAgY29uc3QgZ2VuZXJhdGVkUGFzc3dvcmQgPSBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zbGljZSgtMTApO1xyXG4gICAgY29uc3QgaGFzaGVkID0gYXdhaXQgYmNyeXB0Lmhhc2goZ2VuZXJhdGVkUGFzc3dvcmQsIDEwKTtcclxuICAgIGF3YWl0IHJlcG8uc2V0UGFzc3dvcmQoaWQsIGhhc2hlZCk7XHJcblxyXG4gICAgLy8gc2VuZCBlbWFpbFxyXG4gICAgY29uc3Qgc3ViamVjdCA9ICdZb3VyIHBhc3N3b3JkIGhhcyBiZWVuIHJlc2V0JztcclxuICAgIGNvbnN0IHRleHQgPSBgSGkke3VzZXIuRmlyc3ROYW1lID8gJyAnICsgdXNlci5GaXJzdE5hbWUgOiAnJ30sXHJcbiAgICBZb3VyIHRlbXBvcmFyeSBwYXNzd29yZCBpczogJHtnZW5lcmF0ZWRQYXNzd29yZH1cclxuICAgIFBsZWFzZSBsb2cgaW4gYW5kIGNoYW5nZSBpdCBpbW1lZGlhdGVseS5gO1xyXG5cclxuICAgIGNvbnN0IGh0bWwgPSBgPHA+SGkke3VzZXIuRmlyc3ROYW1lID8gJyAnICsgdXNlci5GaXJzdE5hbWUgOiAnJ30sPC9wPlxyXG4gICAgPHA+WW91ciB0ZW1wb3JhcnkgcGFzc3dvcmQgaXM6IDxiPiR7Z2VuZXJhdGVkUGFzc3dvcmR9PC9iPjwvcD5cclxuICAgIDxwPlBsZWFzZSBsb2cgaW4gYW5kIGNoYW5nZSBpdCBpbW1lZGlhdGVseS48L3A+XHJcbiAgICA8cD7igJQgJHtwcm9jZXNzLmVudi5BUFBfTkFNRSB8fCAnT3VyIEFwcCd9PC9wPmA7XHJcblxyXG4gICAgYXdhaXQgbWFpbGVyLnNlbmRNYWlsKHsgdG86IHVzZXIuRW1haWwsIHN1YmplY3QsIHRleHQsIGh0bWwgfSk7XHJcblxyXG4gICAgcmV0dXJuIHJlcy5qc29uKHsgbWVzc2FnZTogJ1Bhc3N3b3JkIHJlc2V0LiBFbWFpbCBzZW50IHRvIHVzZXIuJyB9KTtcclxuICB9IGNhdGNoIChlKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdyZXNldFBhc3N3b3JkIGVycm9yOicsIGUpO1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgbWVzc2FnZTogJ1Bhc3N3b3JkIHVwZGF0ZWQsIGJ1dCBmYWlsZWQgdG8gc2VuZCBlbWFpbC4nIH0pO1xyXG4gIH1cclxufTtcclxuXHJcbmV4cG9ydHMuY2hhbmdlTXlQYXNzd29yZCA9IGFzeW5jIChyZXEsIHJlcykgPT4ge1xyXG4gIGNvbnN0IHVzZXJJZCA9IHJlcS51c2VyPy5pZDsgLy8gc2V0IGJ5IHlvdXIgYXV0aCBtaWRkbGV3YXJlXHJcbiAgY29uc3QgeyBvbGRQYXNzd29yZCwgbmV3UGFzc3dvcmQgfSA9IHJlcS5ib2R5IHx8IHt9O1xyXG4gIGlmICghdXNlcklkIHx8ICFvbGRQYXNzd29yZCB8fCAhbmV3UGFzc3dvcmQpXHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBtZXNzYWdlOiAnb2xkUGFzc3dvcmQgYW5kIG5ld1Bhc3N3b3JkIGFyZSByZXF1aXJlZCcgfSk7XHJcblxyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB1c2VyID0gYXdhaXQgcmVwby5nZXRCeUlkKHVzZXJJZCk7XHJcbiAgICBjb25zdCBvayA9IGF3YWl0IGJjcnlwdC5jb21wYXJlKG9sZFBhc3N3b3JkLCB1c2VyLlBhc3N3b3JkKTtcclxuICAgIGlmICghb2spIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7IG1lc3NhZ2U6ICdPbGQgcGFzc3dvcmQgaXMgaW5jb3JyZWN0JyB9KTtcclxuXHJcbiAgICBjb25zdCBoYXNoZWQgPSBhd2FpdCBiY3J5cHQuaGFzaChuZXdQYXNzd29yZCwgMTApO1xyXG4gICAgYXdhaXQgcmVwby5zZXRQYXNzd29yZCh1c2VySWQsIGhhc2hlZCk7XHJcblxyXG4gICAgcmVzLmpzb24oeyBtZXNzYWdlOiAnUGFzc3dvcmQgY2hhbmdlZCBzdWNjZXNzZnVsbHknIH0pO1xyXG4gIH0gY2F0Y2ggKGUpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoZSk7XHJcbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7IG1lc3NhZ2U6ICdGYWlsZWQgdG8gY2hhbmdlIHBhc3N3b3JkJyB9KTtcclxuICB9XHJcbn07XHJcbiJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxNQUFNQSxNQUFNLEdBQUdDLE9BQU8sQ0FBQyxVQUFVLENBQUM7QUFDbEMsTUFBTUMsSUFBSSxHQUFHRCxPQUFPLENBQUMsVUFBVSxDQUFDO0FBQ2hDLE1BQU1FLE1BQU0sR0FBR0YsT0FBTyxDQUFDLG9CQUFvQixDQUFDOztBQUU1QztBQUNBLE1BQU1HLGNBQWMsR0FBR0EsQ0FBQ0MsSUFBSSxFQUFFQyxRQUFRLEtBQUs7RUFDekMsS0FBSyxNQUFNQyxDQUFDLElBQUlELFFBQVEsRUFBRSxJQUFJRCxJQUFJLENBQUNFLENBQUMsQ0FBQyxJQUFJLElBQUksSUFBSUYsSUFBSSxDQUFDRSxDQUFDLENBQUMsS0FBSyxFQUFFLEVBQUUsT0FBTyxrQkFBa0JBLENBQUMsRUFBRTtFQUM3RixPQUFPLElBQUk7QUFDYixDQUFDO0FBRURDLE9BQU8sQ0FBQ0MsVUFBVSxHQUFHLE9BQU9DLEdBQUcsRUFBRUMsR0FBRyxLQUFLO0VBQ3ZDLE1BQU1MLFFBQVEsR0FBRyxDQUFDLFFBQVEsRUFBRSxXQUFXLEVBQUUsVUFBVSxFQUFFLFdBQVcsRUFBRSxVQUFVLEVBQUUsT0FBTyxDQUFDO0VBQ3RGLE1BQU1NLEtBQUssR0FBR1IsY0FBYyxDQUFDTSxHQUFHLENBQUNMLElBQUksRUFBRUMs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